"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6836],{6836:(F,m,c)=>{c.r(m),c.d(m,{ComunidadPageModule:()=>D});var d=c(6019),f=c(9010),n=c(6371),p=c(8725),g=c(8239),h=c(8735),Z=c(9241),e=c(865),_=c(1681),k=c(8526);function v(r,u){if(1&r&&e._UZ(0,"img",14),2&r){const i=e.oxw().$implicit;e.Q6J("src",i.imagenPerfil,e.LSH)}}function x(r,u){1&r&&e._UZ(0,"img",15)}function C(r,u){if(1&r){const i=e.EpF();e.TgZ(0,"img",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit;return e.oxw().openImageFullScreen(s.imagen)}),e.qZA()}if(2&r){const i=e.oxw().$implicit;e.Q6J("src",i.imagen,e.LSH)}}function T(r,u){if(1&r){const i=e.EpF();e.TgZ(0,"ion-card"),e.TgZ(1,"ion-item"),e.TgZ(2,"ion-avatar",6),e.YNc(3,v,1,1,"img",7),e.YNc(4,x,1,0,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(6,"ion-label"),e.TgZ(7,"h2"),e._uU(8),e.qZA(),e.TgZ(9,"p"),e._uU(10),e.ALo(11,"date"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"ion-card-content"),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.qZA(),e.TgZ(19,"p"),e._uU(20),e.qZA(),e.TgZ(21,"p"),e._uU(22),e.qZA(),e._UZ(23,"br"),e.YNc(24,C,1,1,"img",9),e.TgZ(25,"ion-button",10),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().likeReporte(a.id)}),e._UZ(26,"ion-icon",11),e.TgZ(27,"span",12),e._uU(28),e.qZA(),e.qZA(),e.TgZ(29,"ion-button",10),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().dislikeReporte(a.id)}),e._UZ(30,"ion-icon",13),e.TgZ(31,"span",12),e._uU(32),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const i=u.$implicit,o=e.MAs(5),s=e.oxw();e.xp6(3),e.Q6J("ngIf",i.imagenPerfil)("ngIfElse",o),e.xp6(5),e.Oqu(i.autor),e.xp6(2),e.Oqu(e.xi3(11,14,i.fechaHora,"dd/MM/yyyy h:mm a")),e.xp6(4),e.Oqu(i.linea),e.xp6(2),e.hij("Estaci\xf3n: ",i.estacion,""),e.xp6(2),e.hij("Direcci\xf3n: ",i.direccion,""),e.xp6(2),e.hij("Reporte: ",i.titulo,""),e.xp6(2),e.hij("Descripcion: ",i.descripcion,""),e.xp6(2),e.Q6J("ngIf",i.imagen),e.xp6(1),e.Q6J("color",s.usuarioHaDadoLike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.likes),e.xp6(1),e.Q6J("color",s.usuarioHaDadoDislike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.dislikes)}}const U=[{path:"",component:(()=>{class r{constructor(i,o,s,a,t){this.router=i,this.reporteService=o,this.modalController=s,this.loadingController=a,this.datosFiltroService=t,this.reportes=[],this.idUser="",this.filtro={},this.previousUrl="",this.router.events.pipe((0,h.h)(l=>l instanceof p.m2)).subscribe(l=>{this.handleNavigation(l.url)}),this.datosFiltroService.isFiltroAplicado().subscribe(l=>{l&&(this.cargarReportes(this.datosFiltroService.getDatosFiltro()),this.datosFiltroService.resetFiltroAplicado())})}handleNavigation(i){this.previousUrl=i}ngOnInit(){this.idUser=localStorage.getItem("id")||"",this.cargarReportes(),this.datosFiltroService.reporteGenerado$.subscribe(i=>{i&&(this.cargarReportes(),this.datosFiltroService.resetReporteGenerado())})}cargarReportes(i={}){var o=this;return(0,g.Z)(function*(){const s=yield o.loadingController.create({message:"Cargando reportes..."});yield s.present(),o.reporteService.obtenerReportes(i).subscribe(function(){var a=(0,g.Z)(function*(t){o.reportes=t,yield s.dismiss()});return function(t){return a.apply(this,arguments)}}(),function(){var a=(0,g.Z)(function*(t){console.error("Error al cargar los reportes: ",t),yield s.dismiss()});return function(t){return a.apply(this,arguments)}}())})()}navegarAFiltroReportes(){this.router.navigate(["/filtro-reportes"])}openImageFullScreen(i){var o=this;return(0,g.Z)(function*(){return yield(yield o.modalController.create({component:Z.U,componentProps:{imageUrl:i}})).present()})()}nuevoReporte(){this.router.navigate(["generar-reporte"])}likeReporte(i){this.reporteService.likeReporte(i,this.idUser).subscribe(o=>{this.actualizarEstadoReporte(i,!0,o.includes("agregado"))})}dislikeReporte(i){this.reporteService.dislikeReporte(i,this.idUser).subscribe(o=>{this.actualizarEstadoReporte(i,!1,o.includes("agregado"))})}actualizarEstadoReporte(i,o,s){const a=this.reportes.findIndex(t=>t.id===i);if(-1!==a){const t=this.reportes[a];o?s?(t.likes++,t.usuariosQueDieronLike.push(this.idUser),t.usuariosQueDieronDislike.includes(this.idUser)&&(t.dislikes--,t.usuariosQueDieronDislike=t.usuariosQueDieronDislike.filter(l=>l!==this.idUser))):(t.likes--,t.usuariosQueDieronLike=t.usuariosQueDieronLike.filter(l=>l!==this.idUser)):s?(t.dislikes++,t.usuariosQueDieronDislike.push(this.idUser),t.usuariosQueDieronLike.includes(this.idUser)&&(t.likes--,t.usuariosQueDieronLike=t.usuariosQueDieronLike.filter(l=>l!==this.idUser))):(t.dislikes--,t.usuariosQueDieronDislike=t.usuariosQueDieronDislike.filter(l=>l!==this.idUser)),this.reportes=[...this.reportes.slice(0,a),t,...this.reportes.slice(a+1)]}}usuarioHaDadoLike(i){const o=this.reportes.find(s=>s.id===i);return o&&o.usuariosQueDieronLike.includes(this.idUser)}usuarioHaDadoDislike(i){const o=this.reportes.find(s=>s.id===i);return o&&o.usuariosQueDieronDislike.includes(this.idUser)}}return r.\u0275fac=function(i){return new(i||r)(e.Y36(p.F0),e.Y36(_.r),e.Y36(n.IN),e.Y36(n.HT),e.Y36(k.z))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-comunidad"]],decls:13,vars:1,consts:[["slot","end"],[3,"click"],["name","filter"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],[4,"ngFor","ngForOf"],["slot","start"],["class","user-image","alt","Foto de perfil",3,"src",4,"ngIf","ngIfElse"],["defaultImage",""],["alt","Imagen del reporte",3,"src","click",4,"ngIf"],["fill","clear",3,"color","click"],["slot","icon-only","name","heart"],[1,"like-dislike-count"],["slot","icon-only","name","heart-dislike"],["alt","Foto de perfil",1,"user-image",3,"src"],["src","assets/imgs/hombre.png","alt","Foto de perfil predeterminada",1,"user-image"],["alt","Imagen del reporte",3,"src","click"]],template:function(i,o){1&i&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3,"Comunidad"),e.qZA(),e.TgZ(4,"ion-buttons",0),e.TgZ(5,"ion-button",1),e.NdJ("click",function(){return o.navegarAFiltroReportes()}),e._UZ(6,"ion-icon",2),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-content"),e.TgZ(8,"ion-fab",3),e.TgZ(9,"ion-fab-button",1),e.NdJ("click",function(){return o.nuevoReporte()}),e._UZ(10,"ion-icon",4),e.qZA(),e.qZA(),e.TgZ(11,"ion-list"),e.YNc(12,T,33,17,"ion-card",5),e.qZA(),e.qZA()),2&i&&(e.xp6(12),e.Q6J("ngForOf",o.reportes))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,n.gu,n.W2,n.IJ,n.W4,n.q_,d.sg,n.PM,n.Ie,n.BJ,d.O5,n.Q$,n.FN],pipes:[d.uU],styles:[".like-dislike-button[_ngcontent-%COMP%]{display:flex;align-items:center}.like-dislike-count[_ngcontent-%COMP%]{margin-left:5px}"]}),r})()}];let A=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[p.Bz.forChild(U)],p.Bz]}),r})(),D=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[d.ez,f.u5,n.Pc,A]]}),r})()}}]);