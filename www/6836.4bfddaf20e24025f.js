"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6836],{6836:(y,f,l)=>{l.r(f),l.d(f,{ComunidadPageModule:()=>P});var p=l(6019),h=l(9010),n=l(6371),g=l(8725),m=l(8239),Z=l(8735),_=l(9241),e=l(865),v=l(1681),k=l(8526),x=l(7524);function C(r,c){if(1&r&&e._UZ(0,"img",14),2&r){const i=e.oxw().$implicit;e.Q6J("src",i.imagenPerfil,e.LSH)}}function T(r,c){1&r&&e._UZ(0,"img",15)}function U(r,c){if(1&r){const i=e.EpF();e.TgZ(0,"img",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit;return e.oxw().openImageFullScreen(s.imagen)}),e.qZA()}if(2&r){const i=e.oxw().$implicit;e.Q6J("src",i.imagen,e.LSH)}}function A(r,c){if(1&r){const i=e.EpF();e.TgZ(0,"ion-card"),e.TgZ(1,"ion-item"),e.TgZ(2,"ion-avatar",6),e.YNc(3,C,1,1,"img",7),e.YNc(4,T,1,0,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(6,"ion-label"),e.TgZ(7,"h2"),e._uU(8),e.qZA(),e.TgZ(9,"p"),e._uU(10),e.ALo(11,"date"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"ion-card-content"),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.qZA(),e.TgZ(19,"p"),e._uU(20),e.qZA(),e.TgZ(21,"p"),e._uU(22),e.qZA(),e._UZ(23,"br"),e.YNc(24,U,1,1,"img",9),e.TgZ(25,"ion-button",10),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().likeReporte(a.id)}),e._UZ(26,"ion-icon",11),e.TgZ(27,"span",12),e._uU(28),e.qZA(),e.qZA(),e.TgZ(29,"ion-button",10),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().dislikeReporte(a.id)}),e._UZ(30,"ion-icon",13),e.TgZ(31,"span",12),e._uU(32),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const i=c.$implicit,o=e.MAs(5),s=e.oxw();e.xp6(3),e.Q6J("ngIf",i.imagenPerfil)("ngIfElse",o),e.xp6(5),e.Oqu(i.autor),e.xp6(2),e.Oqu(e.xi3(11,14,i.fechaHora,"dd/MM/yyyy h:mm a")),e.xp6(4),e.Oqu(i.linea),e.xp6(2),e.hij("Estaci\xf3n: ",i.estacion,""),e.xp6(2),e.hij("Direcci\xf3n: ",i.direccion,""),e.xp6(2),e.hij("Reporte: ",i.titulo,""),e.xp6(2),e.hij("Descripcion: ",i.descripcion,""),e.xp6(2),e.Q6J("ngIf",i.imagen),e.xp6(1),e.Q6J("color",s.usuarioHaDadoLike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.likes),e.xp6(1),e.Q6J("color",s.usuarioHaDadoDislike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.dislikes)}}const D=[{path:"",component:(()=>{class r{constructor(i,o,s,a,t,u){this.router=i,this.reporteService=o,this.modalController=s,this.loadingController=a,this.datosFiltroService=t,this.userService=u,this.reportes=[],this.idUser="",this.filtro={},this.previousUrl="",this.router.events.pipe((0,Z.h)(d=>d instanceof g.m2)).subscribe(d=>{this.handleNavigation(d.url)}),this.datosFiltroService.isFiltroAplicado().subscribe(d=>{d&&(this.cargarReportes(this.datosFiltroService.getDatosFiltro()),this.datosFiltroService.resetFiltroAplicado())})}handleNavigation(i){this.previousUrl=i}ngOnInit(){const i=localStorage.getItem("id");this.idUser=this.userService.decrypt(i),this.cargarReportes(),this.datosFiltroService.reporteGenerado$.subscribe(o=>{o&&(this.cargarReportes(),this.datosFiltroService.resetReporteGenerado())})}cargarReportes(i={}){var o=this;return(0,m.Z)(function*(){const s=yield o.loadingController.create({message:"Cargando reportes..."});yield s.present(),o.reporteService.obtenerReportes(i).subscribe(function(){var a=(0,m.Z)(function*(t){o.reportes=t,yield s.dismiss()});return function(t){return a.apply(this,arguments)}}(),function(){var a=(0,m.Z)(function*(t){console.error("Error al cargar los reportes: ",t),yield s.dismiss()});return function(t){return a.apply(this,arguments)}}())})()}navegarAFiltroReportes(){this.router.navigate(["/filtro-reportes"])}openImageFullScreen(i){var o=this;return(0,m.Z)(function*(){return yield(yield o.modalController.create({component:_.U,componentProps:{imageUrl:i}})).present()})()}nuevoReporte(){this.router.navigate(["generar-reporte"])}likeReporte(i){this.reporteService.likeReporte(i,this.idUser).subscribe(o=>{this.actualizarEstadoReporte(i,!0,o.includes("agregado"))})}dislikeReporte(i){this.reporteService.dislikeReporte(i,this.idUser).subscribe(o=>{this.actualizarEstadoReporte(i,!1,o.includes("agregado"))})}actualizarEstadoReporte(i,o,s){const a=this.reportes.findIndex(t=>t.id===i);if(-1!==a){const t=this.reportes[a];o?s?(t.likes++,t.usuariosQueDieronLike.push(this.idUser),t.usuariosQueDieronDislike.includes(this.idUser)&&(t.dislikes--,t.usuariosQueDieronDislike=t.usuariosQueDieronDislike.filter(u=>u!==this.idUser))):(t.likes--,t.usuariosQueDieronLike=t.usuariosQueDieronLike.filter(u=>u!==this.idUser)):s?(t.dislikes++,t.usuariosQueDieronDislike.push(this.idUser),t.usuariosQueDieronLike.includes(this.idUser)&&(t.likes--,t.usuariosQueDieronLike=t.usuariosQueDieronLike.filter(u=>u!==this.idUser))):(t.dislikes--,t.usuariosQueDieronDislike=t.usuariosQueDieronDislike.filter(u=>u!==this.idUser)),this.reportes=[...this.reportes.slice(0,a),t,...this.reportes.slice(a+1)]}}usuarioHaDadoLike(i){const o=this.reportes.find(s=>s.id===i);return o&&o.usuariosQueDieronLike.includes(this.idUser)}usuarioHaDadoDislike(i){const o=this.reportes.find(s=>s.id===i);return o&&o.usuariosQueDieronDislike.includes(this.idUser)}}return r.\u0275fac=function(i){return new(i||r)(e.Y36(g.F0),e.Y36(v.r),e.Y36(n.IN),e.Y36(n.HT),e.Y36(k.z),e.Y36(x.K))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-comunidad"]],decls:13,vars:1,consts:[["slot","end"],[3,"click"],["name","filter"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],[4,"ngFor","ngForOf"],["slot","start"],["class","user-image","alt","Foto de perfil",3,"src",4,"ngIf","ngIfElse"],["defaultImage",""],["alt","Imagen del reporte",3,"src","click",4,"ngIf"],["fill","clear",3,"color","click"],["slot","icon-only","name","heart"],[1,"like-dislike-count"],["slot","icon-only","name","heart-dislike"],["alt","Foto de perfil",1,"user-image",3,"src"],["src","assets/imgs/hombre.png","alt","Foto de perfil predeterminada",1,"user-image"],["alt","Imagen del reporte",3,"src","click"]],template:function(i,o){1&i&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3,"Comunidad"),e.qZA(),e.TgZ(4,"ion-buttons",0),e.TgZ(5,"ion-button",1),e.NdJ("click",function(){return o.navegarAFiltroReportes()}),e._UZ(6,"ion-icon",2),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-content"),e.TgZ(8,"ion-fab",3),e.TgZ(9,"ion-fab-button",1),e.NdJ("click",function(){return o.nuevoReporte()}),e._UZ(10,"ion-icon",4),e.qZA(),e.qZA(),e.TgZ(11,"ion-list"),e.YNc(12,A,33,17,"ion-card",5),e.qZA(),e.qZA()),2&i&&(e.xp6(12),e.Q6J("ngForOf",o.reportes))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,n.gu,n.W2,n.IJ,n.W4,n.q_,p.sg,n.PM,n.Ie,n.BJ,p.O5,n.Q$,n.FN],pipes:[p.uU],styles:[".like-dislike-button[_ngcontent-%COMP%]{display:flex;align-items:center}.like-dislike-count[_ngcontent-%COMP%]{margin-left:5px}"]}),r})()}];let F=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[g.Bz.forChild(D)],g.Bz]}),r})(),P=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[p.ez,h.u5,n.Pc,F]]}),r})()}}]);