"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6836],{6836:(y,f,l)=>{l.r(f),l.d(f,{ComunidadPageModule:()=>b});var p=l(6019),h=l(9010),n=l(6371),g=l(8725),m=l(8239),_=l(8735),Z=l(9241),e=l(865),v=l(1681),x=l(8526),k=l(7524);function C(o,c){if(1&o){const i=e.EpF();e.TgZ(0,"ion-fab",5),e.TgZ(1,"ion-fab-button",1),e.NdJ("click",function(){return e.CHM(i),e.oxw().nuevoReporte()}),e._UZ(2,"ion-icon",6),e.qZA(),e.qZA()}}function U(o,c){if(1&o&&e._UZ(0,"img",15),2&o){const i=e.oxw().$implicit;e.Q6J("src",i.imagenPerfil,e.LSH)}}function T(o,c){1&o&&e._UZ(0,"img",16)}function A(o,c){if(1&o){const i=e.EpF();e.TgZ(0,"img",17),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit;return e.oxw().openImageFullScreen(s.imagen)}),e.qZA()}if(2&o){const i=e.oxw().$implicit;e.Q6J("src",i.imagen,e.LSH)}}function D(o,c){if(1&o){const i=e.EpF();e.TgZ(0,"ion-card"),e.TgZ(1,"ion-item"),e.TgZ(2,"ion-avatar",7),e.YNc(3,U,1,1,"img",8),e.YNc(4,T,1,0,"ng-template",null,9,e.W1O),e.qZA(),e.TgZ(6,"ion-label"),e.TgZ(7,"h2"),e._uU(8),e.qZA(),e.TgZ(9,"p"),e._uU(10),e.ALo(11,"date"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"ion-card-content"),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.qZA(),e.TgZ(19,"p"),e._uU(20),e.qZA(),e.TgZ(21,"p"),e._uU(22),e.qZA(),e._UZ(23,"br"),e.YNc(24,A,1,1,"img",10),e.TgZ(25,"ion-button",11),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().likeReporte(a.id)}),e._UZ(26,"ion-icon",12),e.TgZ(27,"span",13),e._uU(28),e.qZA(),e.qZA(),e.TgZ(29,"ion-button",11),e.NdJ("click",function(){const a=e.CHM(i).$implicit;return e.oxw().dislikeReporte(a.id)}),e._UZ(30,"ion-icon",14),e.TgZ(31,"span",13),e._uU(32),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const i=c.$implicit,t=e.MAs(5),s=e.oxw();e.xp6(3),e.Q6J("ngIf",i.imagenPerfil)("ngIfElse",t),e.xp6(5),e.Oqu(i.autor),e.xp6(2),e.Oqu(e.xi3(11,14,i.fechaHora,"dd/MM/yyyy h:mm a")),e.xp6(4),e.Oqu(i.linea),e.xp6(2),e.hij("Estaci\xf3n: ",i.estacion,""),e.xp6(2),e.hij("Direcci\xf3n: ",i.direccion,""),e.xp6(2),e.hij("Reporte: ",i.titulo,""),e.xp6(2),e.hij("Descripcion: ",i.descripcion,""),e.xp6(2),e.Q6J("ngIf",i.imagen),e.xp6(1),e.Q6J("color",s.usuarioHaDadoLike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.likes),e.xp6(1),e.Q6J("color",s.usuarioHaDadoDislike(i.id)?"primary":"medium"),e.xp6(3),e.Oqu(i.dislikes)}}const F=[{path:"",component:(()=>{class o{constructor(i,t,s,a,r,u){this.router=i,this.reporteService=t,this.modalController=s,this.loadingController=a,this.datosFiltroService=r,this.userService=u,this.reportes=[],this.idUser="",this.filtro={},this.previousUrl="",this.router.events.pipe((0,_.h)(d=>d instanceof g.m2)).subscribe(d=>{this.handleNavigation(d.url)}),this.datosFiltroService.isFiltroAplicado().subscribe(d=>{d&&(this.cargarReportes(this.datosFiltroService.getDatosFiltro()),this.datosFiltroService.resetFiltroAplicado())})}handleNavigation(i){this.previousUrl=i}ngOnInit(){const i=localStorage.getItem("intro");if(this.isUserLoggedIn=!!i&&"null"!==i,this.isUserLoggedIn){const t=localStorage.getItem("id");this.idUser=this.userService.decrypt(t)}this.cargarReportes(),this.datosFiltroService.reporteGenerado$.subscribe(t=>{t&&(this.cargarReportes(),this.datosFiltroService.resetReporteGenerado())})}cargarReportes(i={}){var t=this;return(0,m.Z)(function*(){const s=yield t.loadingController.create({message:"Cargando reportes..."});yield s.present(),t.reporteService.obtenerReportes(i).subscribe(function(){var a=(0,m.Z)(function*(r){t.reportes=r,yield s.dismiss()});return function(r){return a.apply(this,arguments)}}(),function(){var a=(0,m.Z)(function*(r){console.error("Error al cargar los reportes: ",r),yield s.dismiss()});return function(r){return a.apply(this,arguments)}}())})()}navegarAFiltroReportes(){this.router.navigate(["/filtro-reportes"])}openImageFullScreen(i){var t=this;return(0,m.Z)(function*(){return yield(yield t.modalController.create({component:Z.U,componentProps:{imageUrl:i}})).present()})()}nuevoReporte(){this.router.navigate(["generar-reporte"])}likeReporte(i){this.reporteService.likeReporte(i,this.idUser).subscribe(t=>{this.actualizarEstadoReporte(i,!0,t.includes("agregado"))})}dislikeReporte(i){this.reporteService.dislikeReporte(i,this.idUser).subscribe(t=>{this.actualizarEstadoReporte(i,!1,t.includes("agregado"))})}actualizarEstadoReporte(i,t,s){const a=this.reportes.findIndex(r=>r.id===i);if(-1!==a){const r=this.reportes[a];t?s?(r.likes++,r.usuariosQueDieronLike.push(this.idUser),r.usuariosQueDieronDislike.includes(this.idUser)&&(r.dislikes--,r.usuariosQueDieronDislike=r.usuariosQueDieronDislike.filter(u=>u!==this.idUser))):(r.likes--,r.usuariosQueDieronLike=r.usuariosQueDieronLike.filter(u=>u!==this.idUser)):s?(r.dislikes++,r.usuariosQueDieronDislike.push(this.idUser),r.usuariosQueDieronLike.includes(this.idUser)&&(r.likes--,r.usuariosQueDieronLike=r.usuariosQueDieronLike.filter(u=>u!==this.idUser))):(r.dislikes--,r.usuariosQueDieronDislike=r.usuariosQueDieronDislike.filter(u=>u!==this.idUser)),this.reportes=[...this.reportes.slice(0,a),r,...this.reportes.slice(a+1)]}}usuarioHaDadoLike(i){const t=this.reportes.find(s=>s.id===i);return t&&t.usuariosQueDieronLike.includes(this.idUser)}usuarioHaDadoDislike(i){const t=this.reportes.find(s=>s.id===i);return t&&t.usuariosQueDieronDislike.includes(this.idUser)}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(g.F0),e.Y36(v.r),e.Y36(n.IN),e.Y36(n.HT),e.Y36(x.z),e.Y36(k.K))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-comunidad"]],decls:11,vars:2,consts:[["slot","end"],[3,"click"],["name","filter"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["slot","start"],["class","user-image","alt","Foto de perfil",3,"src",4,"ngIf","ngIfElse"],["defaultImage",""],["alt","Imagen del reporte",3,"src","click",4,"ngIf"],["fill","clear",3,"color","click"],["slot","icon-only","name","heart"],[1,"like-dislike-count"],["slot","icon-only","name","heart-dislike"],["alt","Foto de perfil",1,"user-image",3,"src"],["src","assets/imgs/hombre.png","alt","Foto de perfil predeterminada",1,"user-image"],["alt","Imagen del reporte",3,"src","click"]],template:function(i,t){1&i&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3,"Comunidad"),e.qZA(),e.TgZ(4,"ion-buttons",0),e.TgZ(5,"ion-button",1),e.NdJ("click",function(){return t.navegarAFiltroReportes()}),e._UZ(6,"ion-icon",2),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-content"),e.YNc(8,C,3,0,"ion-fab",3),e.TgZ(9,"ion-list"),e.YNc(10,D,33,17,"ion-card",4),e.qZA(),e.qZA()),2&i&&(e.xp6(8),e.Q6J("ngIf",t.isUserLoggedIn),e.xp6(2),e.Q6J("ngForOf",t.reportes))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,n.gu,n.W2,p.O5,n.q_,p.sg,n.IJ,n.W4,n.PM,n.Ie,n.BJ,n.Q$,n.FN],pipes:[p.uU],styles:[".like-dislike-button[_ngcontent-%COMP%]{display:flex;align-items:center}.like-dislike-count[_ngcontent-%COMP%]{margin-left:5px}"]}),o})()}];let P=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.Bz.forChild(F)],g.Bz]}),o})(),b=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[p.ez,h.u5,n.Pc,P]]}),o})()}}]);